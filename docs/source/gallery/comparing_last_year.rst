
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/comparing_last_year.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_comparing_last_year.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_comparing_last_year.py:


Comparing To Previous Semesters

.. GENERATED FROM PYTHON SOURCE LINES 4-77



.. image-sg:: /gallery/images/sphx_glr_comparing_last_year_001.png
   :alt: comparing last year
   :srcset: /gallery/images/sphx_glr_comparing_last_year_001.png, /gallery/images/sphx_glr_comparing_last_year_001_2_00x.png 2.00x
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    2023-08-21 2023-10-06
    F23 168874
    2024-01-19 2024-03-05
    S24 314912
    2024-08-19 2024-10-04
    F24 554902






|

.. code-block:: Python


    import datetime

    import matplotlib.pyplot as plt
    import numpy as np
    import polars as pl

    import src  # noqa

    df = src.load_tables("Submission")

    df = (
        df.select("timeStarted")
        .filter(pl.col("timeStarted") > pl.date(2020, 1, 1))
        .sort("timeStarted")
    )

    start_this_fall = datetime.date(2024, 8, 19)
    start_last_fall = datetime.date(2023, 8, 21)
    start_last_spring = datetime.date(2024, 1, 19)

    now = datetime.date.today()
    total_days_this_year = now - start_this_fall

    for start_date, label in [
        (start_last_fall, "F23"),
        (start_last_spring, "S24"),
        (start_this_fall, "F24"),
    ]:
        df2 = (
            df.filter(
                pl.col("timeStarted") > start_date,
                pl.col("timeStarted") < start_date + total_days_this_year,
            )
            .group_by(
                pl.col("timeStarted").dt.ordinal_day() * 24
                + pl.col("timeStarted").dt.hour()
            )
            .len()
            .sort("timeStarted")
        )
        print(start_date, start_date + total_days_this_year)

        time_started_full = pl.DataFrame(
            {
                "timeStarted": np.arange(
                    df2["timeStarted"][0], df2["timeStarted"][-1] + 1, dtype=np.int16
                )
            }
        )
        time_started_full = time_started_full.with_columns(
            (pl.col("timeStarted") * 0).alias("len")
        )

        df2 = df2.join(time_started_full, on="timeStarted", how="right").drop("len_right")
        df2 = df2.fill_null(0)

        print(label, df2["len"].sum())

        df2 = df2.with_columns(pl.col("len").cum_sum().alias("len_cum"))

        x = (df2["timeStarted"] - df2["timeStarted"][0]) / 24
        y = df2["len_cum"] / 1e5
        plt.plot(x, y, label=label, linewidth=2)
        plt.fill_between(x, 0 * y, y, alpha=0.1)

    plt.ylabel("Total submissions (hundreds of thousands)")
    plt.xlabel("Day of the semester")
    plt.xlim([0, total_days_this_year.days])
    plt.legend()
    plt.grid()
    plt.tight_layout()
    plt.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.281 seconds)


.. _sphx_glr_download_gallery_comparing_last_year.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: comparing_last_year.ipynb <comparing_last_year.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: comparing_last_year.py <comparing_last_year.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: comparing_last_year.zip <comparing_last_year.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
